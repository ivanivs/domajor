<?phprequire_once ('./../config.php');require_once ('./../include/functions.php');$mysql_connect_id = mysql_connect($config ['host'], $config ['user_datebase'], $config ['password_datebase']);mysql_select_db($config ['database']);mysql_query ("SET NAMES 'utf-8'");$sql = "SELECT `id`,`value` FROM ls_settings;";$results = mysql_query($sql);$number = mysql_num_rows ($results);for ($i=0; $i<$number; $i++){    $array_config_param[] = mysql_fetch_array($results, MYSQL_ASSOC);}foreach ($array_config_param as $key => $v){    $config['user_params_'.$v['id']] = $v['value'];}$sql = "update ls_orders set status='".$_GET['status']."' where id = '".$_GET['id']."';";$infoOrder = getOneString("SELECT * FROM `ls_orders` where `id` = '".intval($_GET['id'])."';");if ($arrayItem = getArray("SELECT * FROM `ls_cart` where `uniq_user` = '".$infoOrder['uniq_user']."'")) {    $allSum = 0;    $arrayCode = Array();    $arrayCodeText = Array();    foreach ($arrayItem as $v) {        $allSum = $allSum + ($v['price'] * $v['number']);        if (intval($_GET['status'])==4){            if ($infoCert = getOneString("SELECT * FROM `ls_certificate` WHERE `itemId` = '".$v['id_item']."'")){                $permitted_chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPRSTUVWXYZ';// Output: 54esmdr0qf                $i = 1;                while ($i <= $v['number']){                    $code = substr(str_shuffle($permitted_chars), 0, 8);                    if (!getOneString("SELECT * FROM `ls_certificate` WHERE `code` = '" . $code . "'")) {                        $arrayCode[$i]['code'] = $code;                        $arrayCode[$i]['price'] = $infoCert['price'];                        $arrayCodeText[] = $code.' - '.$infoCert['price'].'грн.';                        $i++;                    }                }            }        }    }    if (!$info = getOneString("SELECT * FROM `ls_certificate` WHERE `fromOrder` = '".$infoOrder['id']."'")) {        if (isset ($arrayCode) and !empty($arrayCode)) {            foreach ($arrayCode as $code) {                mysql_query("INSERT INTO `ls_certificate` (                    `dateTo`,                    `price`,                     `code`,                     `date`,                    `fromOrder`,                    `automatic`                    ) VALUES (                    '1970-01-01',                    '" . $code['price'] . "',                     '" . $code['code'] . "',                     '" . date("Y-m-d") . "',                    '" . $infoOrder['id'] . "',                    1                    );");            }            $codeToSms = 'Ваш подарунковий сертифікат на покупку у www.bobas.ua: ' . implode(', ', $arrayCodeText);//        echo $infoOrder['number_phone'].' - '.$codeToSms;            go_sms($infoOrder['number_phone'], $codeToSms);        }    }}$bonus = $allSum/100*5;if ($_GET['status']==4){    $infoCountBonus = getOneString("SELECT COUNT(*) FROM `ls_bonus` WHERE `idOrder` = '".$infoOrder['id']."'");    if ($infoCountBonus['COUNT(*)']==0){    if (mysql_query("INSERT INTO  `ls_bonus` (    `idUser` ,    `bonus` ,    `time` ,    `idOrder` ,    `type`    )    VALUES (    '".$infoOrder['id_user']."' ,    '".$bonus."' ,    '".time()."' ,    '".$infoOrder['id']."' ,    'in'    );")){        $bonusHtml = '<br>Бонус надано: '.$bonus.' грн.';    }    } else {        $bonusHtml = '<br>Бонус не надано - ВЖЕ Є';    }}mysql_query($sql);print "<span style=\"color:red; padding: 10px; border: 1px solid red;\">Успішно збережено</span>".$bonusHtml;?>