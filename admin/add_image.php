<?phprequire_once ('./../config.php');$mysql_connect_id = mysql_connect($config ['host'], $config ['user_datebase'], $config ['password_datebase']);mysql_select_db($config ['database']);mysql_query ("SET NAMES 'UTF8'");require_once ('./../include/functions.php');require ('engine/products/functions.php');require ('engine/params/functions.php');if (isset ($_GET['lang'])){	setcookie ("lang", $_GET['lang'], time() + $config['time_life_cookie']);}$lang_file_array = return_my_language ();foreach ($lang_file_array as $v){	require_once($v);}require_once ('./../include/cookie.php');if (isset ($_COOKIE['lang']) or isset ($_GET['lang'])){	if (isset ($_COOKIE['lang']))	{		$alt_name_online_lang = $_COOKIE['lang'];	} else {		$alt_name_online_lang = $_GET['lang'];	}	$info_for_my_lang = return_info_for_lang_for_alt_name($alt_name_online_lang);	$id_online_lang = $info_for_my_lang['id'];} else {	$info_for_my_lang = return_info_for_lang_for_alt_name($config ['default_language']);	$id_online_lang = $info_for_my_lang['id'];}if (isset ($_COOKIE['id_user_online'])){	$body = '<title>'.$lang[182].'</title> 	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">	<link rel="stylesheet" href="'.$config ['site_url'].'css/dragula.min.css">	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script><script type="text/javascript" src="'.$config ['site_url'].'js/tooltipjs.js"></script> <script type="text/javascript" src="'.$config ['site_url'].'js/jquery.tablesorter.min.js"></script> <script type="text/javascript" src="'.$config ['site_url'].'js/jquery.MultiFile.js"></script> <script type="text/javascript" src="'.$config ['site_url'].'js/jquery.form.js"></script> <script type="text/javascript" src="'.$config ['site_url'].'js/jquery.blockUI.js"></script> <script type="text/javascript" src="'.$config ['site_url'].'js/dragula.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>	';	if (!isset ($_GET['id_param']))	{		$array_image_param = return_param_for_card_image ($_GET['id']);		$body .= '		<h1 style="font-size:16px; color:#1B618C">'.$lang[183].'</h1>		<table border="0">';		foreach ($array_image_param as $value)		{			$translate_image = return_one_translate ($value['id_param'], $id_online_lang, 'image');			$body .= '<tr>			<td><b>'.$translate_image['text'].'</b></td>			<td width="50" align="center"><a href="add_image.php?id='.$_GET['id'].'&id_param='.$value['id'].'&id_item='.$_GET['id_item'].'"><img src="'.$config ['site_url'].'images/admin/next.png"></td>			</tr>';		}	} else {		$info_cardparam = return_one_cardparam ($_GET['id_param']);		$info_param_image = return_one_image_param ($info_cardparam['id_param']);//		$body .= '//                        <script type="text/javascript">//                        $(document).ready(function(){////                        $(\'.MultiFile\').MultiFile({//                                accept:\'JPG|GIF|PNG|jpg|gif|png\', max:'.$info_param_image['number_image'].', STRING: {//                                        remove:\''.$lang[133].'\',//                                        file:\'$file\',//                                        selected:\''.$lang[134].': $file\',//                                        denied:\''.$lang[135].': $ext!\',//                                        duplicate:\''.$lang[136].':\n$file!\'//                                }//                        });////                        $("#loading").ajaxStart(function(){//                                $(this).show();//                        })//                        .ajaxComplete(function(){//                                $(this).hide();//                        });//////                        $(\'#uploadForm\').ajaxForm({//                                beforeSubmit: function(a,f,o) {//                                        o.dataType = "html";//                                        $(\'#uploadOutput\').html(\''.$lang[138].'...\');//                                },//                                success: function(data) {//                                        var $out = $(\'#uploadOutput\');//                                        $out.html(\''.$lang[137].' <a href="add_image.php?id='.$_GET['id'].'&id_param='.$_GET['id_param'].'&id_item='.$_GET['id_item'].'">'.$lang[184].'</a>\');//                                        if (typeof data == \'object\' && data.nodeType)//                                                data = elementToString(data.documentElement, true);//                                        else if (typeof data == \'object\')//                                                data = objToString(data);//                                        $out.append(\'<div><pre>\'+ data +\'</pre></div>\');//                                }//                        });//                        });//                        </script>//                        <div align="center">//						<h2>'.$lang[190].'</h2>//                            <form id="uploadForm" action="engine/products/action/doajaxfileupload.php?id_card='.$_GET['id'].'&id_cardparam='.$_GET['id_param'].'&id_item='.$_GET['id_item'].'" method="post" enctype="multipart/form-data">//                            <input name="MAX_FILE_SIZE" value="10000000" type="hidden"/>//                            <input name="fileToUpload[]" id="fileToUpload" class="MultiFile" type="file"/>//                            <input name="id_select" type="hidden" value="'.$_GET['id'].'"/><br>//                            <input value="Submit" type="submit"/>//                            </form>//                            <img id="loading" src="'.$config ['site_url'].'images/admin/loading.gif" style="display:none;"/>//                            <div id="uploadOutput"></div>//                        </div>//        ';        $body .= '		<script>		var countUpload = 0;		var countToUpload = 0;		function sendFileAddItem(file, id) {            data = new FormData();            data.append("fileToUpload", file);            url = "engine/products/action/doajaxfileupload.php?id_card='.$_GET['id'].'&id_cardparam='.$_GET['id_param'].'&id_item='.$_GET['id_item'].'";            $.ajax({                data: data,                type: "POST",                url: url,                cache: false,                contentType: false,                processData: false,                success: function (result) {                    countUpload++;                    if (countToUpload==countUpload)                        location.reload();                },            });        }            $( document ).ready(function() {                    $(\'#inputPhoto\').on(\'change\', function(){                        var inputFile = $("#inputPhoto").prop("files");                        var countFile = inputFile.length;                        countToUpload = countFile;                        for (var i=0; i<countFile; i++){                            $("#loading").show();                            sendFileAddItem(inputFile[i], i);                        }                    });            });        </script>                        <div align="center">						<h2>'.$lang[190].'</h2>                            <form id="uploadForm" action="" method="post" enctype="multipart/form-data">                                <input name="fileToUpload[]" id="inputPhoto" class="MultiFile" type="file" multiple/>                                <input name="id_select" type="hidden" value="'.$_GET['id'].'"/><br>                            </form>                            <img id="loading" src="'.$config ['site_url'].'images/admin/loading.gif" style="display:none;"/>                               <div id="uploadOutput"></div>                        </div>        ';		if (isset ($_GET['up']))		{			$info_this_param = return_image_for_card_one_for_id ($_GET['up']);			$info_next_param = return_image_for_card_one_for_position ($info_this_param['position']+1, $_GET['id_param']);			if (count ($info_next_param)>1)			{				$sql = "update ls_values_image set position='".$info_next_param['position']."' where id='".$info_this_param['id']."';";				mysql_query ($sql);				$sql = "update ls_values_image set position='".$info_this_param['position']."' where id='".$info_next_param['id']."';";				mysql_query ($sql);			}		}		if (isset ($_GET['down']))		{			$info_this_param = return_image_for_card_one_for_id ($_GET['down']);			$info_next_param = return_image_for_card_one_for_position ($info_this_param['position']-1, $_GET['id_param']);			if (count ($info_next_param)>1)			{				$sql = "update ls_values_image set position='".$info_next_param['position']."' where id='".$info_this_param['id']."';";				mysql_query ($sql);				$sql = "update ls_values_image set position='".$info_this_param['position']."' where id='".$info_next_param['id']."';";				mysql_query ($sql);			}		}		if (isset($_GET['del']))		{			$sql = "DELETE from `ls_values_image` where `id` = '".$_GET['del']."';";			mysql_query($sql);		}		$position = 1;		$array_image = return_all_image_for_id_item ($_GET['id_item'], $_GET['id_param']);		if ($array_image)		{			$body .= '			<div style="text-align: center"><h2>'.$lang[191].'</h2></div>			<script>			var dragulaSmallPhotoVar;                        function dragulaSmallPhoto(){                dragulaSmallPhotoVar = dragula([                      document.getElementById("smallImageBlock")                    ], {                      isContainer: function (el) {                        return false; // only elements in drake.containers will be taken into account                      },                      moves: function (element, container, handle) {                        return handle.classList.contains("drag-handle-class");                      },                      accepts: function (el, target, source, sibling) {                        return true; // elements can be dropped in any of the `containers` by default                      },                      invalid: function (el, handle) {                        return false; // don\'t prevent any drags from initiating by default                      },                      direction: \'vertical\',             // Y axis is considered when determining where an element would be dropped                      copy: false,                       // elements are moved by default, not copied                      copySortSource: false,             // elements in copy-source containers can be reordered                      revertOnSpill: false,              // spilling will put the element back where it was dragged from, if this is true                      removeOnSpill: false,              // spilling will `.remove` the element, if this is true                      mirrorContainer: document.body,    // set the element that gets mirror elements appended                      ignoreInputTextSelection: true,     // allows users to select input text, see details below                      slideFactorX: 0,               // allows users to select the amount of movement on the X axis before it is considered a drag instead of a click                      slideFactorY: 0,               // allows users to select the amount of movement on the Y axis before it is considered a drag instead of a click                    }).on(\'drop\', function (el) {                        var arrayData = [];                        $( "#smallImageBlock > div").each( function( index, element) {                            arrayData[index]  = $( element).attr( "id");                            console.log( "id:", $( element).attr( "id"));                        });                        $.ajax({                                type: "POST",                                url: "index.php?do=ajax&ajax=savePhotoPosition",                                data: {                                    id: '.intval($_GET['id_item']).',                                    data: JSON.stringify(arrayData),                                },                                dataType: \'html\',                                success: function(result) {                                                                    },                            });                      });            }            $( document ).ready(function() {                const moveList = document.querySelectorAll(\'div.drag-handle-class\');                if (moveList)                {                    moveList.forEach(move =>                    {                        move.addEventListener(\'touchmove\', event => event.preventDefault());                    });                }                    dragulaSmallPhoto();                });            </script>			<div class="container">			<div class="row" id="smallImageBlock">			';			foreach ($array_image as $v)			{				if ($v['position']==0)				{					$position = $v['position'];				}				//https://bobas.ua/resize_image.php?filename=16055468615_203.300.66.jpg&const=128&width=262&height=262&r=255&g=255&b=255//				$body .= '<tr>//				<td><a href="add_image.php?id='.$_GET['id'].'&id_param='.$_GET['id_param'].'&id_item='.$_GET['id_item'].'&up='.$v['id'].'"><img src="'.$config ['site_url'].'images/admin/1uparrow.png" border="0"></a>//				<a href="add_image.php?id='.$_GET['id'].'&id_param='.$_GET['id_param'].'&id_item='.$_GET['id_item'].'&down='.$v['id'].'"><img src="'.$config ['site_url'].'images/admin/1downarrow.png" border="0"></td>//				<td><img src="'.$config ['site_url'].'resize_image.php?filename='.urlencode($v['value']).'&const=128&width=262&height=262&r=255&g=255&b=255"></td>//				<td><a href="add_image.php?id='.$_GET['id'].'&id_param='.$_GET['id_param'].'&id_item='.$_GET['id_item'].'&del='.$v['id'].'" onclick="return confirm (\''.$lang[69].'\')"><img src="'.$config ['site_url'].'images/admin/remove_16.png" border="0"></a></td>//				</tr>';                $body .= '                <div class="col-lg-3" style="margin-top:20px; text-align: center;" id="image_'.$v['id'].'">                    <img src="'.$config ['site_url'].'resize_image.php?filename='.urlencode($v['value']).'&const=128&width=262&height=262&r=255&g=255&b=255" class="drag-handle-class img-fluid img-thumbnail">                    <a href="add_image.php?id='.$_GET['id'].'&id_param='.$_GET['id_param'].'&id_item='.$_GET['id_item'].'&del='.$v['id'].'" onclick="return confirm (\''.$lang[69].'\')"><img src="'.$config ['site_url'].'images/admin/remove_16.png" border="0"></a>                </div>                ';			}			$body .= '</div></div>';		}		if ($position==0)		{			foreach ($array_image as $key => $v)			{				$pos = count($array_image)-$key;				$sql = "UPDATE ls_values_image set position='".$pos."' where id='".$v['id']."';";				mysql_query ($sql);			}		}	}	print $body;}?>